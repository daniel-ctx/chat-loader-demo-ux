{"ast":null,"code":"var _jsxFileName = \"/Users/daniel/Desktop/chat-response/src/components/ChatPromptInput/ChatPromptInput.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useState, useEffect } from 'react';\nimport './ChatPromptInput.scss';\nimport { IconAt, IconPlayerStop, IconX } from '@tabler/icons-react';\nimport { ArrowUpOutlined } from '@ant-design/icons';\nimport AnimatedPlaceholder from '../AnimatedPlaceholder';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BASE_SUGGESTIONS = ['areas_quentes', 'base_1', 'base_2', 'lojas jun-2025', 'lojas mai-2025', 'lojas abr-2025'];\nexport default function ChatPromptInput({\n  value,\n  onChange,\n  onSend,\n  onInsertBase,\n  aiTyping,\n  onCancelAi\n}) {\n  _s();\n  const inputRef = useRef();\n  const [showDropdown, setShowDropdown] = useState(false);\n  const [filteredBases, setFilteredBases] = useState(BASE_SUGGESTIONS);\n  const [selectedIdx, setSelectedIdx] = useState(0);\n  const [lastCaret, setLastCaret] = useState(null);\n  const [hoveredIdx, setHoveredIdx] = useState(null);\n  const [focused, setFocused] = useState(false);\n  const [hasText, setHasText] = useState(false);\n  const [tooltip, setTooltip] = useState(false);\n  const tooltipTimeoutRef = useRef();\n  const [selectedTag, setSelectedTag] = useState(null);\n  const itemRefs = useRef([]);\n\n  // Atualiza value externo e estado de texto\n  useEffect(() => {\n    if (onChange) onChange(getPlainText());\n    setHasText(!!getPlainText().trim() || selectedTag !== null);\n    // eslint-disable-next-line\n  }, []);\n\n  // Helper para pegar texto puro\n  function getPlainText() {\n    var _inputRef$current;\n    return ((_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.innerText) || '';\n  }\n\n  // Helper para inserir HTML no cursor\n  function insertHtmlAtCaret(html) {\n    let sel, range;\n    if (window.getSelection) {\n      sel = window.getSelection();\n      if (sel.getRangeAt && sel.rangeCount) {\n        range = sel.getRangeAt(0);\n        range.deleteContents();\n        const el = document.createElement('div');\n        el.innerHTML = html;\n        const frag = document.createDocumentFragment();\n        let node, lastNode;\n        while (node = el.firstChild) {\n          lastNode = frag.appendChild(node);\n        }\n        range.insertNode(frag);\n        // Move caret após a tag\n        if (lastNode) {\n          range = range.cloneRange();\n          range.setStartAfter(lastNode);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    }\n  }\n\n  // Helper para contar tags\n  function hasTag() {\n    return selectedTag !== null;\n  }\n\n  // Verifica se o texto digitado é uma referência à tag já selecionada\n  function isReferencingSelectedTag(text) {\n    if (!selectedTag) return false;\n    const match = text.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n    if (!match) return false;\n    return match[1].toLowerCase() === selectedTag.toLowerCase();\n  }\n\n  // Detecta @ e abre dropdown (apenas se não houver tag)\n  function handleInput(e) {\n    if (hasTag()) {\n      const textUntilCursor = inputRef.current.innerText;\n      const match = textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n      if (match && selectedTag) {\n        if (selectedTag.toLowerCase().startsWith(match[1].toLowerCase())) {\n          setShowDropdown(true);\n          setFilteredBases([selectedTag]);\n          setSelectedIdx(0);\n          if (onChange) onChange(inputRef.current.innerText);\n          setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n          return;\n        } else if (match[1].length > 0) {\n          // Se digitou algo diferente, mostra tooltip\n          setShowDropdown(false);\n          setFilteredBases(BASE_SUGGESTIONS);\n          setSelectedIdx(0);\n          if (onChange) onChange(inputRef.current.innerText);\n          setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n          setTooltip(true);\n          clearTimeout(tooltipTimeoutRef.current);\n          tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n          return;\n        }\n      }\n      setShowDropdown(false);\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n      if (onChange) onChange(inputRef.current.innerText);\n      setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n      // Mostra tooltip apenas se tentar digitar exatamente o caractere @\n      const isAtAttempt = e.inputType === 'insertText' && e.data === '@' || !e.inputType && inputRef.current.innerText.endsWith('@');\n      if (isAtAttempt) {\n        setTooltip(true);\n        clearTimeout(tooltipTimeoutRef.current);\n        tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n      }\n      return;\n    }\n    const sel = window.getSelection();\n    setLastCaret(sel && sel.getRangeAt && sel.rangeCount ? sel.getRangeAt(0) : null);\n    let textUntilCursor = '';\n    if (sel && sel.rangeCount) {\n      const range = sel.getRangeAt(0);\n      const preRange = range.cloneRange();\n      preRange.selectNodeContents(inputRef.current);\n      preRange.setEnd(range.endContainer, range.endOffset);\n      textUntilCursor = preRange.toString();\n    } else {\n      textUntilCursor = inputRef.current.innerText;\n    }\n    const match = textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n    if (match) {\n      setShowDropdown(true);\n      filterBases(match[1]);\n    } else {\n      setShowDropdown(false);\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n    }\n    if (onChange) onChange(inputRef.current.innerText);\n    setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n  }\n  function filterBases(query) {\n    if (!query) {\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n      return;\n    }\n    const q = query.toLowerCase();\n    const filtered = BASE_SUGGESTIONS.filter(b => b.toLowerCase().includes(q));\n    setFilteredBases(filtered);\n    setSelectedIdx(0);\n  }\n\n  // Navegação teclado\n  function handleKeyDown(e) {\n    if (showDropdown) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedIdx(idx => (idx + 1) % filteredBases.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedIdx(idx => (idx - 1 + filteredBases.length) % filteredBases.length);\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (filteredBases.length > 0) {\n          handleSelectBase(filteredBases[selectedIdx]);\n        }\n      } else if (e.key === 'Escape') {\n        setShowDropdown(false);\n      }\n    } else if (e.key === 'Enter' && !e.shiftKey) {\n      if (aiTyping) {\n        e.preventDefault(); // Não envia nada enquanto loading\n        return;\n      }\n      e.preventDefault();\n      if (onSend) onSend(getTextToSend());\n      inputRef.current.innerHTML = '';\n      if (onChange) onChange('');\n      setHasText(false);\n      setSelectedTag(null);\n    }\n  }\n\n  // Seleciona base\n  function handleSelectBase(base) {\n    const cameFromDropdown = showDropdown;\n    // Se já existe contexto e tentar selecionar outra base, mostra tooltip\n    if (selectedTag && base.toLowerCase() !== selectedTag.toLowerCase()) {\n      setTooltip(true);\n      clearTimeout(tooltipTimeoutRef.current);\n      tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n      setShowDropdown(false);\n      return;\n    }\n    setShowDropdown(false);\n    setSelectedTag(base);\n    setHasText(!!getPlainText().trim() || base !== null);\n    if (cameFromDropdown) {\n      const sel = window.getSelection();\n      if (sel && sel.rangeCount) {\n        const range = sel.getRangeAt(0);\n        // Move o range para cobrir o @palavra antes do cursor\n        const node = range.startContainer;\n        let text = node.textContent;\n        const match = text.slice(0, range.startOffset).match(/@([\\w\\u00C0-\\u017F-]*)$/);\n        if (match) {\n          const start = range.startOffset - match[0].length;\n          range.setStart(node, start);\n          // Remove o @palavra\n          range.deleteContents();\n          // Insere a tag\n          const el = document.createElement('span');\n          el.className = 'chat-tag';\n          el.contentEditable = 'false';\n          el.textContent = `@${base}`;\n          range.insertNode(el);\n          // Espaço após a tag\n          const space = document.createTextNode(' ');\n          el.after(space);\n          // Move o cursor após o espaço\n          range.setStartAfter(space);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    }\n    if (onChange) onChange(getPlainText());\n    setTimeout(() => inputRef.current.focus(), 0);\n  }\n\n  // Botão inserir base (só se não houver tag)\n  function handleInsertBase() {\n    if (hasTag()) return;\n    inputRef.current.focus();\n    insertHtmlAtCaret('@');\n    const sel = window.getSelection();\n    if (sel && sel.rangeCount) {\n      const range = sel.getRangeAt(0);\n      range.setStart(range.endContainer, range.endOffset);\n      range.collapse(true);\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n    setShowDropdown(true);\n    setFilteredBases(BASE_SUGGESTIONS);\n    setSelectedIdx(0);\n  }\n\n  // Inserir contexto via botão (sem modificar texto)\n  function handleInsertContext() {\n    if (hasTag()) return;\n    // Abre dropdown para seleção\n    setShowDropdown(true);\n    setFilteredBases(BASE_SUGGESTIONS);\n    setSelectedIdx(0);\n    inputRef.current.focus();\n  }\n\n  // Permite apagar tags normalmente\n  function handleBeforeInput(e) {\n    // Permite edição normal\n  }\n\n  // Clique na tag para remover\n  function handleClick(e) {\n    if (e.target.classList.contains('chat-tag')) {\n      e.preventDefault();\n      e.target.remove();\n      setSelectedTag(null);\n      if (onChange) onChange(getPlainText());\n    }\n  }\n\n  // Remove tag do botão\n  function handleRemoveTag() {\n    var _inputRef$current2;\n    setSelectedTag(null);\n    setHasText(!!getPlainText().trim());\n    // Remove a tag do input também\n    const tagElement = (_inputRef$current2 = inputRef.current) === null || _inputRef$current2 === void 0 ? void 0 : _inputRef$current2.querySelector('.chat-tag');\n    if (tagElement) {\n      tagElement.remove();\n      if (onChange) onChange(getPlainText());\n    }\n  }\n\n  // Limpa timeout do tooltip ao desmontar\n  useEffect(() => {\n    return () => clearTimeout(tooltipTimeoutRef.current);\n  }, []);\n\n  // Helper para pegar texto a ser enviado\n  function getTextToSend() {\n    const plainText = getPlainText().trim();\n    if (plainText) {\n      return plainText;\n    }\n    // Se não há texto mas há contexto selecionado, envia o nome da tag com @\n    if (selectedTag) {\n      return `@${selectedTag}`;\n    }\n    return '';\n  }\n  useEffect(() => {\n    if (showDropdown && itemRefs.current[selectedIdx]) {\n      itemRefs.current[selectedIdx].scrollIntoView({\n        block: 'nearest'\n      });\n    }\n  }, [selectedIdx, showDropdown]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-prompt-input-wrapper\",\n    style: {\n      position: 'relative'\n    },\n    children: [tooltip && /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"chat-tooltip\",\n      children: \"S\\xF3 \\xE9 poss\\xEDvel inserir uma base por mensagem.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'flex-end',\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-prompt-input\",\n        contentEditable: true,\n        ref: inputRef,\n        spellCheck: true,\n        onInput: handleInput,\n        onKeyDown: handleKeyDown,\n        onBeforeInput: handleBeforeInput,\n        onClick: handleClick,\n        onFocus: () => setFocused(true),\n        onBlur: () => setFocused(false),\n        \"data-placeholder\": \"Digite sua mensagem. Use @ para inserir uma base.\",\n        style: {\n          minHeight: 60,\n          outline: 'none',\n          whiteSpace: 'pre-wrap',\n          flex: 1,\n          position: 'relative'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"chat-add-context\",\n          onClick: handleInsertContext,\n          disabled: hasTag(),\n          children: [/*#__PURE__*/_jsxDEV(IconAt, {\n            size: 12\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 13\n          }, this), \"Inserir contexto\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 11\n        }, this), selectedTag && /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"chat-context\",\n          children: [/*#__PURE__*/_jsxDEV(IconAt, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 15\n          }, this), selectedTag, /*#__PURE__*/_jsxDEV(IconX, {\n            className: \"close-ic\",\n            onClick: handleRemoveTag\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 357,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `chat-send-btn${hasText && !aiTyping ? ' active' : ''}${aiTyping ? ' loading' : ''}`,\n          type: \"button\",\n          onClick: () => {\n            if (aiTyping) {\n              if (onCancelAi) onCancelAi();\n            } else {\n              if (!showDropdown && onSend && hasText) {\n                onSend(getTextToSend());\n                inputRef.current.innerHTML = '';\n                if (onChange) onChange('');\n                setHasText(false);\n                setSelectedTag(null);\n              }\n            }\n          },\n          disabled: aiTyping && !onCancelAi || !hasText && !aiTyping,\n          children: aiTyping ? /*#__PURE__*/_jsxDEV(IconPlayerStop, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 25\n          }, this) : /*#__PURE__*/_jsxDEV(ArrowUpOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 46\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 7\n    }, this), (!inputRef.current || !inputRef.current.innerText.trim()) && !focused && /*#__PURE__*/_jsxDEV(AnimatedPlaceholder, {\n      messages: ['Digite aqui para adicionar uma nova camada ao mapa', 'Tem alguma dúvida? Escreva aqui', 'Digite aqui para criar uma camada ou para tirar uma dúvida', 'Descreva a camada a ser criada ou pergunte algo', 'Digite @ para inserir um contexto de uma base de dados', 'Precisa de ajuda com o mapa? Fale aqui', 'Vamos explorar o mapa juntos? Escreva aqui a sua ideia'],\n      inputFocused: focused,\n      inputHtml: inputRef.current ? inputRef.current.innerHTML : ''\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 9\n    }, this), showDropdown && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-suggestions-dropdown\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Bases dispon\\xEDveis\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: filteredBases.length === 0 ? /*#__PURE__*/_jsxDEV(\"li\", {\n          className: \"no-suggestion\",\n          children: \"Resultado n\\xE3o encontrado\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 15\n        }, this) : filteredBases.map((base, i) => /*#__PURE__*/_jsxDEV(\"li\", {\n          ref: el => itemRefs.current[i] = el,\n          className: hoveredIdx === i || hoveredIdx === null && selectedIdx === i ? 'selected' : '',\n          onMouseDown: e => e.preventDefault(),\n          onMouseEnter: () => setHoveredIdx(i),\n          onMouseLeave: () => setHoveredIdx(null),\n          onClick: e => {\n            e.preventDefault();\n            handleSelectBase(base);\n          },\n          children: base\n        }, base, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 320,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPromptInput, \"+2XPXpqFRMblVp6w3V0wIgpf5Sw=\");\n_c = ChatPromptInput;\nvar _c;\n$RefreshReg$(_c, \"ChatPromptInput\");","map":{"version":3,"names":["React","useRef","useState","useEffect","IconAt","IconPlayerStop","IconX","ArrowUpOutlined","AnimatedPlaceholder","jsxDEV","_jsxDEV","BASE_SUGGESTIONS","ChatPromptInput","value","onChange","onSend","onInsertBase","aiTyping","onCancelAi","_s","inputRef","showDropdown","setShowDropdown","filteredBases","setFilteredBases","selectedIdx","setSelectedIdx","lastCaret","setLastCaret","hoveredIdx","setHoveredIdx","focused","setFocused","hasText","setHasText","tooltip","setTooltip","tooltipTimeoutRef","selectedTag","setSelectedTag","itemRefs","getPlainText","trim","_inputRef$current","current","innerText","insertHtmlAtCaret","html","sel","range","window","getSelection","getRangeAt","rangeCount","deleteContents","el","document","createElement","innerHTML","frag","createDocumentFragment","node","lastNode","firstChild","appendChild","insertNode","cloneRange","setStartAfter","collapse","removeAllRanges","addRange","hasTag","isReferencingSelectedTag","text","match","toLowerCase","handleInput","e","textUntilCursor","startsWith","length","clearTimeout","setTimeout","isAtAttempt","inputType","data","endsWith","preRange","selectNodeContents","setEnd","endContainer","endOffset","toString","filterBases","query","q","filtered","filter","b","includes","handleKeyDown","key","preventDefault","idx","handleSelectBase","shiftKey","getTextToSend","base","cameFromDropdown","startContainer","textContent","slice","startOffset","start","setStart","className","contentEditable","space","createTextNode","after","focus","handleInsertBase","handleInsertContext","handleBeforeInput","handleClick","target","classList","contains","remove","handleRemoveTag","_inputRef$current2","tagElement","querySelector","plainText","scrollIntoView","block","style","position","children","fileName","_jsxFileName","lineNumber","columnNumber","display","alignItems","width","ref","spellCheck","onInput","onKeyDown","onBeforeInput","onClick","onFocus","onBlur","minHeight","outline","whiteSpace","flex","type","disabled","size","messages","inputFocused","inputHtml","map","i","onMouseDown","onMouseEnter","onMouseLeave","_c","$RefreshReg$"],"sources":["/Users/daniel/Desktop/chat-response/src/components/ChatPromptInput/ChatPromptInput.js"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport './ChatPromptInput.scss';\nimport { IconAt, IconPlayerStop, IconX } from '@tabler/icons-react';\nimport { ArrowUpOutlined } from '@ant-design/icons';\nimport AnimatedPlaceholder from '../AnimatedPlaceholder';\n\nconst BASE_SUGGESTIONS = [\n  'areas_quentes',\n  'base_1',\n  'base_2',\n  'lojas jun-2025',\n  'lojas mai-2025',\n  'lojas abr-2025'\n];\n\nexport default function ChatPromptInput({ value, onChange, onSend, onInsertBase, aiTyping, onCancelAi }) {\n  const inputRef = useRef();\n  const [showDropdown, setShowDropdown] = useState(false);\n  const [filteredBases, setFilteredBases] = useState(BASE_SUGGESTIONS);\n  const [selectedIdx, setSelectedIdx] = useState(0);\n  const [lastCaret, setLastCaret] = useState(null);\n  const [hoveredIdx, setHoveredIdx] = useState(null);\n  const [focused, setFocused] = useState(false);\n  const [hasText, setHasText] = useState(false);\n  const [tooltip, setTooltip] = useState(false);\n  const tooltipTimeoutRef = useRef();\n  const [selectedTag, setSelectedTag] = useState(null);\n  const itemRefs = useRef([]);\n\n  // Atualiza value externo e estado de texto\n  useEffect(() => {\n    if (onChange) onChange(getPlainText());\n    setHasText(!!getPlainText().trim() || selectedTag !== null);\n    // eslint-disable-next-line\n  }, []);\n\n  // Helper para pegar texto puro\n  function getPlainText() {\n    return inputRef.current?.innerText || '';\n  }\n\n  // Helper para inserir HTML no cursor\n  function insertHtmlAtCaret(html) {\n    let sel, range;\n    if (window.getSelection) {\n      sel = window.getSelection();\n      if (sel.getRangeAt && sel.rangeCount) {\n        range = sel.getRangeAt(0);\n        range.deleteContents();\n        const el = document.createElement('div');\n        el.innerHTML = html;\n        const frag = document.createDocumentFragment();\n        let node, lastNode;\n        while ((node = el.firstChild)) {\n          lastNode = frag.appendChild(node);\n        }\n        range.insertNode(frag);\n        // Move caret após a tag\n        if (lastNode) {\n          range = range.cloneRange();\n          range.setStartAfter(lastNode);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    }\n  }\n\n  // Helper para contar tags\n  function hasTag() {\n    return selectedTag !== null;\n  }\n\n  // Verifica se o texto digitado é uma referência à tag já selecionada\n  function isReferencingSelectedTag(text) {\n    if (!selectedTag) return false;\n    const match = text.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n    if (!match) return false;\n    return match[1].toLowerCase() === selectedTag.toLowerCase();\n  }\n\n  // Detecta @ e abre dropdown (apenas se não houver tag)\n  function handleInput(e) {\n    if (hasTag()) {\n      const textUntilCursor = inputRef.current.innerText;\n      const match = textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n      if (match && selectedTag) {\n        if (selectedTag.toLowerCase().startsWith(match[1].toLowerCase())) {\n          setShowDropdown(true);\n          setFilteredBases([selectedTag]);\n          setSelectedIdx(0);\n          if (onChange) onChange(inputRef.current.innerText);\n          setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n          return;\n        } else if (match[1].length > 0) {\n          // Se digitou algo diferente, mostra tooltip\n          setShowDropdown(false);\n          setFilteredBases(BASE_SUGGESTIONS);\n          setSelectedIdx(0);\n          if (onChange) onChange(inputRef.current.innerText);\n          setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n          setTooltip(true);\n          clearTimeout(tooltipTimeoutRef.current);\n          tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n          return;\n        }\n      }\n      setShowDropdown(false);\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n      if (onChange) onChange(inputRef.current.innerText);\n      setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n      // Mostra tooltip apenas se tentar digitar exatamente o caractere @\n      const isAtAttempt = (e.inputType === 'insertText' && e.data === '@') ||\n        (!e.inputType && inputRef.current.innerText.endsWith('@'));\n      if (isAtAttempt) {\n        setTooltip(true);\n        clearTimeout(tooltipTimeoutRef.current);\n        tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n      }\n      return;\n    }\n    const sel = window.getSelection();\n    setLastCaret(sel && sel.getRangeAt && sel.rangeCount ? sel.getRangeAt(0) : null);\n    let textUntilCursor = '';\n    if (sel && sel.rangeCount) {\n      const range = sel.getRangeAt(0);\n      const preRange = range.cloneRange();\n      preRange.selectNodeContents(inputRef.current);\n      preRange.setEnd(range.endContainer, range.endOffset);\n      textUntilCursor = preRange.toString();\n    } else {\n      textUntilCursor = inputRef.current.innerText;\n    }\n    const match = textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n    if (match) {\n      setShowDropdown(true);\n      filterBases(match[1]);\n    } else {\n      setShowDropdown(false);\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n    }\n    if (onChange) onChange(inputRef.current.innerText);\n    setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n  }\n\n  function filterBases(query) {\n    if (!query) {\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n      return;\n    }\n    const q = query.toLowerCase();\n    const filtered = BASE_SUGGESTIONS.filter(b => b.toLowerCase().includes(q));\n    setFilteredBases(filtered);\n    setSelectedIdx(0);\n  }\n\n  // Navegação teclado\n  function handleKeyDown(e) {\n    if (showDropdown) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedIdx(idx => (idx + 1) % filteredBases.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedIdx(idx => (idx - 1 + filteredBases.length) % filteredBases.length);\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (filteredBases.length > 0) {\n          handleSelectBase(filteredBases[selectedIdx]);\n        }\n      } else if (e.key === 'Escape') {\n        setShowDropdown(false);\n      }\n    } else if (e.key === 'Enter' && !e.shiftKey) {\n      if (aiTyping) {\n        e.preventDefault(); // Não envia nada enquanto loading\n        return;\n      }\n      e.preventDefault();\n      if (onSend) onSend(getTextToSend());\n      inputRef.current.innerHTML = '';\n      if (onChange) onChange('');\n      setHasText(false);\n      setSelectedTag(null);\n    }\n  }\n\n  // Seleciona base\n  function handleSelectBase(base) {\n    const cameFromDropdown = showDropdown;\n    // Se já existe contexto e tentar selecionar outra base, mostra tooltip\n    if (selectedTag && base.toLowerCase() !== selectedTag.toLowerCase()) {\n      setTooltip(true);\n      clearTimeout(tooltipTimeoutRef.current);\n      tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n      setShowDropdown(false);\n      return;\n    }\n    setShowDropdown(false);\n    setSelectedTag(base);\n    setHasText(!!getPlainText().trim() || base !== null);\n    if (cameFromDropdown) {\n      const sel = window.getSelection();\n      if (sel && sel.rangeCount) {\n        const range = sel.getRangeAt(0);\n        // Move o range para cobrir o @palavra antes do cursor\n        const node = range.startContainer;\n        let text = node.textContent;\n        const match = text.slice(0, range.startOffset).match(/@([\\w\\u00C0-\\u017F-]*)$/);\n        if (match) {\n          const start = range.startOffset - match[0].length;\n          range.setStart(node, start);\n          // Remove o @palavra\n          range.deleteContents();\n          // Insere a tag\n          const el = document.createElement('span');\n          el.className = 'chat-tag';\n          el.contentEditable = 'false';\n          el.textContent = `@${base}`;\n          range.insertNode(el);\n          // Espaço após a tag\n          const space = document.createTextNode(' ');\n          el.after(space);\n          // Move o cursor após o espaço\n          range.setStartAfter(space);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    }\n    if (onChange) onChange(getPlainText());\n    setTimeout(() => inputRef.current.focus(), 0);\n  }\n\n  // Botão inserir base (só se não houver tag)\n  function handleInsertBase() {\n    if (hasTag()) return;\n    inputRef.current.focus();\n    insertHtmlAtCaret('@');\n    const sel = window.getSelection();\n    if (sel && sel.rangeCount) {\n      const range = sel.getRangeAt(0);\n      range.setStart(range.endContainer, range.endOffset);\n      range.collapse(true);\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n    setShowDropdown(true);\n    setFilteredBases(BASE_SUGGESTIONS);\n    setSelectedIdx(0);\n  }\n\n  // Inserir contexto via botão (sem modificar texto)\n  function handleInsertContext() {\n    if (hasTag()) return;\n    // Abre dropdown para seleção\n    setShowDropdown(true);\n    setFilteredBases(BASE_SUGGESTIONS);\n    setSelectedIdx(0);\n    inputRef.current.focus();\n  }\n\n  // Permite apagar tags normalmente\n  function handleBeforeInput(e) {\n    // Permite edição normal\n  }\n\n  // Clique na tag para remover\n  function handleClick(e) {\n    if (e.target.classList.contains('chat-tag')) {\n      e.preventDefault();\n      e.target.remove();\n      setSelectedTag(null);\n      if (onChange) onChange(getPlainText());\n    }\n  }\n\n  // Remove tag do botão\n  function handleRemoveTag() {\n    setSelectedTag(null);\n    setHasText(!!getPlainText().trim());\n    // Remove a tag do input também\n    const tagElement = inputRef.current?.querySelector('.chat-tag');\n    if (tagElement) {\n      tagElement.remove();\n      if (onChange) onChange(getPlainText());\n    }\n  }\n\n  // Limpa timeout do tooltip ao desmontar\n  useEffect(() => {\n    return () => clearTimeout(tooltipTimeoutRef.current);\n  }, []);\n\n  // Helper para pegar texto a ser enviado\n  function getTextToSend() {\n    const plainText = getPlainText().trim();\n    if (plainText) {\n      return plainText;\n    }\n    // Se não há texto mas há contexto selecionado, envia o nome da tag com @\n    if (selectedTag) {\n      return `@${selectedTag}`;\n    }\n    return '';\n  }\n\n  useEffect(() => {\n    if (showDropdown && itemRefs.current[selectedIdx]) {\n      itemRefs.current[selectedIdx].scrollIntoView({ block: 'nearest' });\n    }\n  }, [selectedIdx, showDropdown]);\n\n  return (\n    <div className=\"chat-prompt-input-wrapper\" style={{ position: 'relative' }}>\n      {tooltip && (\n        <span className=\"chat-tooltip\">Só é possível inserir uma base por mensagem.</span>\n      )}\n      <div style={{ display: 'flex', alignItems: 'flex-end', width: '100%' }}>\n        <div\n          className=\"chat-prompt-input\"\n          contentEditable\n          ref={inputRef}\n          spellCheck={true}\n          onInput={handleInput}\n          onKeyDown={handleKeyDown}\n          onBeforeInput={handleBeforeInput}\n          onClick={handleClick}\n          onFocus={() => setFocused(true)}\n          onBlur={() => setFocused(false)}\n          data-placeholder=\"Digite sua mensagem. Use @ para inserir uma base.\"\n          style={{ minHeight: 60, outline: 'none', whiteSpace: 'pre-wrap', flex: 1, position: 'relative' }}\n        />\n        <div className='input-actions'>\n          <button\n            type=\"button\"\n            className=\"chat-add-context\"\n            onClick={handleInsertContext}\n            disabled={hasTag()}\n          >\n            <IconAt size={12} />\n            Inserir contexto\n          </button>\n          {selectedTag && (\n            <button\n              type=\"button\"\n              className=\"chat-context\"\n              \n            >\n              <IconAt  />\n              {selectedTag}\n              <IconX className='close-ic' onClick={handleRemoveTag}/>\n            </button>\n          )}\n          <button\n            className={`chat-send-btn${hasText && !aiTyping ? ' active' : ''}${aiTyping ? ' loading' : ''}`}\n            type=\"button\"\n            onClick={() => {\n              if (aiTyping) {\n                if (onCancelAi) onCancelAi();\n              } else {\n                if (!showDropdown && onSend && hasText) {\n                  onSend(getTextToSend());\n                  inputRef.current.innerHTML = '';\n                  if (onChange) onChange('');\n                  setHasText(false);\n                  setSelectedTag(null);\n                }\n              }\n            }}\n            disabled={aiTyping && !onCancelAi || !hasText && !aiTyping}\n          >\n            {aiTyping ? <IconPlayerStop /> : <ArrowUpOutlined />}\n          </button>\n        </div>\n      </div>\n      {/* Placeholder animado sobre o input */}\n      {(!inputRef.current || !inputRef.current.innerText.trim()) && !focused && (\n        <AnimatedPlaceholder\n          messages={[\n            'Digite aqui para adicionar uma nova camada ao mapa',\n            'Tem alguma dúvida? Escreva aqui',\n            'Digite aqui para criar uma camada ou para tirar uma dúvida',\n            'Descreva a camada a ser criada ou pergunte algo',\n            'Digite @ para inserir um contexto de uma base de dados',\n            'Precisa de ajuda com o mapa? Fale aqui',\n            'Vamos explorar o mapa juntos? Escreva aqui a sua ideia',\n          ]}\n          inputFocused={focused}\n          inputHtml={inputRef.current ? inputRef.current.innerHTML : ''}\n        />\n      )}\n      {showDropdown && (\n        <div className=\"chat-suggestions-dropdown\">\n          <h3>Bases disponíveis</h3>\n          <ul>\n            {filteredBases.length === 0 ? (\n              <li className=\"no-suggestion\">Resultado não encontrado</li>\n            ) : (\n              filteredBases.map((base, i) => (\n                <li\n                  ref={el => itemRefs.current[i] = el}\n                  key={base}\n                  className={(hoveredIdx === i || (hoveredIdx === null && selectedIdx === i)) ? 'selected' : ''}\n                  onMouseDown={e => e.preventDefault()}\n                  onMouseEnter={() => setHoveredIdx(i)}\n                  onMouseLeave={() => setHoveredIdx(null)}\n                  onClick={e => {\n                    e.preventDefault();\n                    handleSelectBase(base);\n                  }}\n                >\n                  {base}\n                </li>\n              ))\n            )}\n          </ul>\n        </div>\n      )}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}