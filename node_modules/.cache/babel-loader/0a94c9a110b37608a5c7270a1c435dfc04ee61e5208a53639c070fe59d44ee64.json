{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{RightOutlined}from'@ant-design/icons';import logo from'../../img/logo.svg';import'./Chat.scss';import aiResponses from'./aiResponses';import MessageLog from'../MessageLog';import ChatPromptInput from'../ChatPromptInput';import{useRef as useReactRef}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getRandomAiResponse=()=>{const idx=Math.floor(Math.random()*aiResponses.length);return aiResponses[idx];};const initialAiGreeting={sender:'ai',text:'Olá! Sou o Cortex AI, estou aqui para te ajudar a explorar, analisar e entender seus dados geográficos. O que deseja fazer agora?'};// Retorna um tempo aleatório inteiro de segundos entre 5s e 50s\nfunction getRandomDelay(){const seconds=Math.floor(Math.random()*(50-5+1))+5;// 5s a 50s\nreturn{ms:seconds*1000,seconds};}const Chat=_ref=>{let{onProcessingStart,onProcessingEnd}=_ref;const[messages,setMessages]=useState([initialAiGreeting]);const[mentionsValue,setMentionsValue]=useState('');const[aiTyping,setAiTyping]=useState(false);const[pendingAiMsg,setPendingAiMsg]=useState('');const[showTypewriter,setShowTypewriter]=useState(false);const messagesEndRef=useRef(null);const[prompt,setPrompt]=useState('');const aiTimeoutRef=useReactRef();const[processingSeconds,setProcessingSeconds]=useState(null);const[mode,setMode]=useState('B');// Modo será determinado pelo tempo\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[messages,aiTyping,showTypewriter]);const handleSend=e=>{e.preventDefault();const textToSend=mentionsValue.trim();if(!textToSend)return;setMessages([...messages,{sender:'user',text:textToSend}]);setMentionsValue('');setAiTyping(true);setShowTypewriter(false);const aiMsg=getRandomAiResponse();setPendingAiMsg(aiMsg);const delay=getRandomDelay();// Determinar modo baseado no tempo: <10s = B, >=10s = C\nconst selectedMode=delay.seconds<10?'B':'C';setMode(selectedMode);setProcessingSeconds(delay.seconds);if(onProcessingStart)onProcessingStart(delay.seconds);aiTimeoutRef.current=setTimeout(()=>{setShowTypewriter(true);},delay.ms);};const handleCancelAi=()=>{if(aiTimeoutRef.current){clearTimeout(aiTimeoutRef.current);aiTimeoutRef.current=null;}setAiTyping(false);setShowTypewriter(false);setPendingAiMsg('');setProcessingSeconds(null);if(onProcessingEnd)onProcessingEnd();};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-onmaps\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"logo\",style:{cursor:'pointer'},onClick:()=>setMessages([initialAiGreeting])}),/*#__PURE__*/_jsx(\"span\",{className:\"chat-chevron\",children:/*#__PURE__*/_jsx(RightOutlined,{})})]}),/*#__PURE__*/_jsx(MessageLog,{messages:messages,aiTyping:aiTyping,showTypewriter:showTypewriter,pendingAiMsg:pendingAiMsg,mode:mode,processingSeconds:processingSeconds,onTypewriterEnd:()=>{setMessages(msgs=>[...msgs,{sender:'ai',text:pendingAiMsg}]);setAiTyping(false);setShowTypewriter(false);setPendingAiMsg('');const finishedSeconds=processingSeconds;setProcessingSeconds(null);if(onProcessingEnd)onProcessingEnd(finishedSeconds);},messagesEndRef:messagesEndRef}),/*#__PURE__*/_jsx(\"form\",{className:\"chat-footer\",onSubmit:handleSend,children:/*#__PURE__*/_jsx(ChatPromptInput,{value:prompt,onChange:setPrompt,onSend:text=>{if(!text.trim())return;setMessages([...messages,{sender:'user',text}]);setPrompt('');setAiTyping(true);setShowTypewriter(false);const aiMsg=getRandomAiResponse();setPendingAiMsg(aiMsg);const delay=getRandomDelay();// Determinar modo baseado no tempo: <10s = B, >=10s = C\nconst selectedMode=delay.seconds<10?'B':'C';setMode(selectedMode);setProcessingSeconds(delay.seconds);if(onProcessingStart)onProcessingStart(delay.seconds);aiTimeoutRef.current=setTimeout(()=>{setShowTypewriter(true);},delay.ms);},aiTyping:aiTyping,onCancelAi:handleCancelAi})})]});};export default Chat;","map":{"version":3,"names":["React","useState","useRef","useEffect","RightOutlined","logo","aiResponses","MessageLog","ChatPromptInput","useReactRef","jsx","_jsx","jsxs","_jsxs","getRandomAiResponse","idx","Math","floor","random","length","initialAiGreeting","sender","text","getRandomDelay","seconds","ms","Chat","_ref","onProcessingStart","onProcessingEnd","messages","setMessages","mentionsValue","setMentionsValue","aiTyping","setAiTyping","pendingAiMsg","setPendingAiMsg","showTypewriter","setShowTypewriter","messagesEndRef","prompt","setPrompt","aiTimeoutRef","processingSeconds","setProcessingSeconds","mode","setMode","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSend","e","preventDefault","textToSend","trim","aiMsg","delay","selectedMode","setTimeout","handleCancelAi","clearTimeout","className","children","src","alt","style","cursor","onClick","onTypewriterEnd","msgs","finishedSeconds","onSubmit","value","onChange","onSend","onCancelAi"],"sources":["/Users/daniel/Desktop/chat-response/src/components/Chat/Chat.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { RightOutlined } from '@ant-design/icons';\nimport logo from '../../img/logo.svg';\nimport './Chat.scss';\nimport aiResponses from './aiResponses';\n\nimport MessageLog from '../MessageLog';\nimport ChatPromptInput from '../ChatPromptInput';\nimport { useRef as useReactRef } from 'react';\n\n\nconst getRandomAiResponse = () => {\n  const idx = Math.floor(Math.random() * aiResponses.length);\n  return aiResponses[idx];\n};\n\nconst initialAiGreeting = { sender: 'ai', text: 'Olá! Sou o Cortex AI, estou aqui para te ajudar a explorar, analisar e entender seus dados geográficos. O que deseja fazer agora?' };\n\n// Retorna um tempo aleatório inteiro de segundos entre 5s e 50s\nfunction getRandomDelay() {\n  const seconds = Math.floor(Math.random() * (50 - 5 + 1)) + 5; // 5s a 50s\n  return { ms: seconds * 1000, seconds };\n}\n\nconst Chat = ({ onProcessingStart, onProcessingEnd }) => {\n  const [messages, setMessages] = useState([initialAiGreeting]);\n  const [mentionsValue, setMentionsValue] = useState('');\n  const [aiTyping, setAiTyping] = useState(false);\n  const [pendingAiMsg, setPendingAiMsg] = useState('');\n  const [showTypewriter, setShowTypewriter] = useState(false);\n  const messagesEndRef = useRef(null);\n  const [prompt, setPrompt] = useState('');\n  const aiTimeoutRef = useReactRef();\n  const [processingSeconds, setProcessingSeconds] = useState(null);\n  const [mode, setMode] = useState('B'); // Modo será determinado pelo tempo\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages, aiTyping, showTypewriter]);\n\n  const handleSend = (e) => {\n    e.preventDefault();\n    const textToSend = mentionsValue.trim();\n    if (!textToSend) return;\n    setMessages([...messages, { sender: 'user', text: textToSend }]);\n    setMentionsValue('');\n    setAiTyping(true);\n    setShowTypewriter(false);\n    const aiMsg = getRandomAiResponse();\n    setPendingAiMsg(aiMsg);\n    const delay = getRandomDelay();\n    \n    // Determinar modo baseado no tempo: <10s = B, >=10s = C\n    const selectedMode = delay.seconds < 10 ? 'B' : 'C';\n    setMode(selectedMode);\n    \n    setProcessingSeconds(delay.seconds);\n    if (onProcessingStart) onProcessingStart(delay.seconds);\n    aiTimeoutRef.current = setTimeout(() => {\n      setShowTypewriter(true);\n    }, delay.ms);\n  };\n\n  const handleCancelAi = () => {\n    if (aiTimeoutRef.current) {\n      clearTimeout(aiTimeoutRef.current);\n      aiTimeoutRef.current = null;\n    }\n    setAiTyping(false);\n    setShowTypewriter(false);\n    setPendingAiMsg('');\n    setProcessingSeconds(null);\n    if (onProcessingEnd) onProcessingEnd();\n  };\n\n  return (\n    <div className=\"chat-onmaps\">\n      <header className=\"chat-header\">\n        <img src={logo} alt=\"logo\" style={{ cursor: 'pointer' }} onClick={() => setMessages([initialAiGreeting])} />\n        <span className=\"chat-chevron\"><RightOutlined /></span>\n      </header>\n      <MessageLog\n        messages={messages}\n        aiTyping={aiTyping}\n        showTypewriter={showTypewriter}\n        pendingAiMsg={pendingAiMsg}\n        mode={mode}\n        processingSeconds={processingSeconds}\n        onTypewriterEnd={() => {\n          setMessages((msgs) => [\n            ...msgs,\n            { sender: 'ai', text: pendingAiMsg }\n          ]);\n          setAiTyping(false);\n          setShowTypewriter(false);\n          setPendingAiMsg('');\n          const finishedSeconds = processingSeconds;\n          setProcessingSeconds(null);\n          if (onProcessingEnd) onProcessingEnd(finishedSeconds);\n        }}\n        messagesEndRef={messagesEndRef}\n      />\n      <form className=\"chat-footer\" onSubmit={handleSend}>\n        <ChatPromptInput\n          value={prompt}\n          onChange={setPrompt}\n          onSend={text => {\n            if (!text.trim()) return;\n            setMessages([...messages, { sender: 'user', text }]);\n            setPrompt('');\n            setAiTyping(true);\n            setShowTypewriter(false);\n            const aiMsg = getRandomAiResponse();\n            setPendingAiMsg(aiMsg);\n            const delay = getRandomDelay();\n            \n            // Determinar modo baseado no tempo: <10s = B, >=10s = C\n            const selectedMode = delay.seconds < 10 ? 'B' : 'C';\n            setMode(selectedMode);\n            \n            setProcessingSeconds(delay.seconds);\n            if (onProcessingStart) onProcessingStart(delay.seconds);\n            aiTimeoutRef.current = setTimeout(() => {\n              setShowTypewriter(true);\n            }, delay.ms);\n          }}\n          aiTyping={aiTyping}\n          onCancelAi={handleCancelAi}\n        />\n      </form>\n    </div>\n  );\n};\n\nexport default Chat; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}