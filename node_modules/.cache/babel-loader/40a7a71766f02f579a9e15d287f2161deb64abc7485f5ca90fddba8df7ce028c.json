{"ast":null,"code":"import React,{useRef,useState,useEffect}from'react';import'./ChatPromptInput.scss';import{IconAt,IconPlayerStop,IconX}from'@tabler/icons-react';import{ArrowUpOutlined}from'@ant-design/icons';import AnimatedPlaceholder from'../AnimatedPlaceholder';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BASE_SUGGESTIONS=['areas_quentes','base_1','base_2','lojas jun-2025','lojas mai-2025','lojas abr-2025'];export default function ChatPromptInput(_ref){let{value,onChange,onSend,onInsertBase,aiTyping,onCancelAi}=_ref;const inputRef=useRef();const[showDropdown,setShowDropdown]=useState(false);const[filteredBases,setFilteredBases]=useState(BASE_SUGGESTIONS);const[selectedIdx,setSelectedIdx]=useState(0);const[lastCaret,setLastCaret]=useState(null);const[hoveredIdx,setHoveredIdx]=useState(null);const[focused,setFocused]=useState(false);const[hasText,setHasText]=useState(false);const[tooltip,setTooltip]=useState(false);const tooltipTimeoutRef=useRef();const[selectedTag,setSelectedTag]=useState(null);const itemRefs=useRef([]);// Atualiza value externo e estado de texto\nuseEffect(()=>{if(onChange)onChange(getPlainText());setHasText(!!getPlainText().trim()||selectedTag!==null);// eslint-disable-next-line\n},[]);// Helper para pegar texto puro\nfunction getPlainText(){var _inputRef$current;return((_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.innerText)||'';}// Helper para inserir HTML no cursor\nfunction insertHtmlAtCaret(html){let sel,range;if(window.getSelection){sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0);range.deleteContents();const el=document.createElement('div');el.innerHTML=html;const frag=document.createDocumentFragment();let node,lastNode;while(node=el.firstChild){lastNode=frag.appendChild(node);}range.insertNode(frag);// Move caret após a tag\nif(lastNode){range=range.cloneRange();range.setStartAfter(lastNode);range.collapse(true);sel.removeAllRanges();sel.addRange(range);}}}}// Helper para contar tags\nfunction hasTag(){return selectedTag!==null;}// Verifica se o texto digitado é uma referência à tag já selecionada\nfunction isReferencingSelectedTag(text){if(!selectedTag)return false;const match=text.match(/@([\\w\\u00C0-\\u017F-]*)$/);if(!match)return false;return match[1].toLowerCase()===selectedTag.toLowerCase();}// Detecta @ e abre dropdown (apenas se não houver tag)\nfunction handleInput(e){if(hasTag()){const textUntilCursor=inputRef.current.innerText;const match=textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);if(match&&selectedTag){if(selectedTag.toLowerCase().startsWith(match[1].toLowerCase())){setShowDropdown(true);setFilteredBases([selectedTag]);setSelectedIdx(0);if(onChange)onChange(inputRef.current.innerText);setHasText(!!inputRef.current.innerText.trim()||selectedTag!==null);return;}else if(match[1].length>0){// Se digitou algo diferente, mostra tooltip\nsetShowDropdown(false);setFilteredBases(BASE_SUGGESTIONS);setSelectedIdx(0);if(onChange)onChange(inputRef.current.innerText);setHasText(!!inputRef.current.innerText.trim()||selectedTag!==null);setTooltip(true);clearTimeout(tooltipTimeoutRef.current);tooltipTimeoutRef.current=setTimeout(()=>setTooltip(false),2000);return;}}setShowDropdown(false);setFilteredBases(BASE_SUGGESTIONS);setSelectedIdx(0);if(onChange)onChange(inputRef.current.innerText);setHasText(!!inputRef.current.innerText.trim()||selectedTag!==null);// Mostra tooltip apenas se tentar digitar exatamente o caractere @\nconst isAtAttempt=e.inputType==='insertText'&&e.data==='@'||!e.inputType&&inputRef.current.innerText.endsWith('@');if(isAtAttempt){setTooltip(true);clearTimeout(tooltipTimeoutRef.current);tooltipTimeoutRef.current=setTimeout(()=>setTooltip(false),2000);}return;}const sel=window.getSelection();setLastCaret(sel&&sel.getRangeAt&&sel.rangeCount?sel.getRangeAt(0):null);let textUntilCursor='';if(sel&&sel.rangeCount){const range=sel.getRangeAt(0);const preRange=range.cloneRange();preRange.selectNodeContents(inputRef.current);preRange.setEnd(range.endContainer,range.endOffset);textUntilCursor=preRange.toString();}else{textUntilCursor=inputRef.current.innerText;}const match=textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);if(match){setShowDropdown(true);filterBases(match[1]);}else{setShowDropdown(false);setFilteredBases(BASE_SUGGESTIONS);setSelectedIdx(0);}if(onChange)onChange(inputRef.current.innerText);setHasText(!!inputRef.current.innerText.trim()||selectedTag!==null);}function filterBases(query){if(!query){setFilteredBases(BASE_SUGGESTIONS);setSelectedIdx(0);return;}const q=query.toLowerCase();const filtered=BASE_SUGGESTIONS.filter(b=>b.toLowerCase().includes(q));setFilteredBases(filtered);setSelectedIdx(0);}// Navegação teclado\nfunction handleKeyDown(e){if(showDropdown){if(e.key==='ArrowDown'){e.preventDefault();setSelectedIdx(idx=>(idx+1)%filteredBases.length);}else if(e.key==='ArrowUp'){e.preventDefault();setSelectedIdx(idx=>(idx-1+filteredBases.length)%filteredBases.length);}else if(e.key==='Enter'){e.preventDefault();if(filteredBases.length>0){handleSelectBase(filteredBases[selectedIdx]);}}else if(e.key==='Escape'){setShowDropdown(false);}}else if(e.key==='Enter'&&!e.shiftKey){if(aiTyping){e.preventDefault();// Não envia nada enquanto loading\nreturn;}e.preventDefault();if(onSend)onSend(getTextToSend());inputRef.current.innerHTML='';if(onChange)onChange('');setHasText(false);setSelectedTag(null);}}// Seleciona base\nfunction handleSelectBase(base){const cameFromDropdown=showDropdown;// Se já existe contexto e tentar selecionar outra base, mostra tooltip\nif(selectedTag&&base.toLowerCase()!==selectedTag.toLowerCase()){setTooltip(true);clearTimeout(tooltipTimeoutRef.current);tooltipTimeoutRef.current=setTimeout(()=>setTooltip(false),2000);setShowDropdown(false);return;}setShowDropdown(false);setSelectedTag(base);setHasText(!!getPlainText().trim()||base!==null);if(cameFromDropdown){const sel=window.getSelection();if(sel&&sel.rangeCount){const range=sel.getRangeAt(0);// Move o range para cobrir o @palavra antes do cursor\nconst node=range.startContainer;let text=node.textContent;const match=text.slice(0,range.startOffset).match(/@([\\w\\u00C0-\\u017F-]*)$/);if(match){const start=range.startOffset-match[0].length;range.setStart(node,start);// Remove o @palavra\nrange.deleteContents();// Insere a tag\nconst el=document.createElement('span');el.className='chat-tag';el.contentEditable='false';el.textContent=\"@\".concat(base);range.insertNode(el);// Espaço após a tag\nconst space=document.createTextNode(' ');el.after(space);// Move o cursor após o espaço\nrange.setStartAfter(space);range.collapse(true);sel.removeAllRanges();sel.addRange(range);}}}if(onChange)onChange(getPlainText());setTimeout(()=>inputRef.current.focus(),0);}// Botão inserir base (só se não houver tag)\nfunction handleInsertBase(){if(hasTag())return;inputRef.current.focus();insertHtmlAtCaret('@');const sel=window.getSelection();if(sel&&sel.rangeCount){const range=sel.getRangeAt(0);range.setStart(range.endContainer,range.endOffset);range.collapse(true);sel.removeAllRanges();sel.addRange(range);}setShowDropdown(true);setFilteredBases(BASE_SUGGESTIONS);setSelectedIdx(0);}// Inserir contexto via botão (sem modificar texto)\nfunction handleInsertContext(){if(hasTag())return;// Abre dropdown para seleção\nsetShowDropdown(true);setFilteredBases(BASE_SUGGESTIONS);setSelectedIdx(0);inputRef.current.focus();}// Permite apagar tags normalmente\nfunction handleBeforeInput(e){// Permite edição normal\n}// Clique na tag para remover\nfunction handleClick(e){if(e.target.classList.contains('chat-tag')){e.preventDefault();e.target.remove();setSelectedTag(null);if(onChange)onChange(getPlainText());}}// Remove tag do botão\nfunction handleRemoveTag(){var _inputRef$current2;setSelectedTag(null);setHasText(!!getPlainText().trim());// Remove a tag do input também\nconst tagElement=(_inputRef$current2=inputRef.current)===null||_inputRef$current2===void 0?void 0:_inputRef$current2.querySelector('.chat-tag');if(tagElement){tagElement.remove();if(onChange)onChange(getPlainText());}}// Limpa timeout do tooltip ao desmontar\nuseEffect(()=>{return()=>clearTimeout(tooltipTimeoutRef.current);},[]);// Helper para pegar texto a ser enviado\nfunction getTextToSend(){const plainText=getPlainText().trim();if(plainText){return plainText;}// Se não há texto mas há contexto selecionado, envia o nome da tag com @\nif(selectedTag){return\"@\".concat(selectedTag);}return'';}useEffect(()=>{if(showDropdown&&itemRefs.current[selectedIdx]){itemRefs.current[selectedIdx].scrollIntoView({block:'nearest'});}},[selectedIdx,showDropdown]);return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-prompt-input-wrapper\",style:{position:'relative'},children:[tooltip&&/*#__PURE__*/_jsx(\"span\",{className:\"chat-tooltip\",children:\"S\\xF3 \\xE9 poss\\xEDvel inserir uma base por mensagem.\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'flex-end',width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-prompt-input\",contentEditable:true,ref:inputRef,spellCheck:true,onInput:handleInput,onKeyDown:handleKeyDown,onBeforeInput:handleBeforeInput,onClick:handleClick,onFocus:()=>setFocused(true),onBlur:()=>setFocused(false),\"data-placeholder\":\"Digite sua mensagem. Use @ para inserir uma base.\",style:{minHeight:60,outline:'none',whiteSpace:'pre-wrap',flex:1,position:'relative'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-actions\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"chat-add-context\",onClick:handleInsertContext,disabled:hasTag(),children:[/*#__PURE__*/_jsx(IconAt,{size:12}),\"Inserir contexto\"]}),selectedTag&&/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"chat-context\",children:[/*#__PURE__*/_jsx(IconAt,{}),selectedTag,/*#__PURE__*/_jsx(IconX,{className:\"close-ic\",onClick:handleRemoveTag})]}),/*#__PURE__*/_jsx(\"button\",{className:\"chat-send-btn\".concat(hasText&&!aiTyping?' active':'').concat(aiTyping?' loading':''),type:\"button\",onClick:()=>{if(aiTyping){if(onCancelAi)onCancelAi();}else{if(!showDropdown&&onSend&&hasText){onSend(getTextToSend());inputRef.current.innerHTML='';if(onChange)onChange('');setHasText(false);setSelectedTag(null);}}},disabled:aiTyping&&!onCancelAi||!hasText&&!aiTyping,children:aiTyping?/*#__PURE__*/_jsx(IconPlayerStop,{}):/*#__PURE__*/_jsx(ArrowUpOutlined,{})})]})]}),(!inputRef.current||!inputRef.current.innerText.trim())&&!focused&&/*#__PURE__*/_jsx(AnimatedPlaceholder,{messages:['Digite aqui para adicionar uma nova camada ao mapa','Tem alguma dúvida? Escreva aqui','Digite aqui para criar uma camada ou para tirar uma dúvida','Descreva a camada a ser criada ou pergunte algo','Digite @ para inserir um contexto de uma base de dados','Precisa de ajuda com o mapa? Fale aqui','Vamos explorar o mapa juntos? Escreva aqui a sua ideia'],inputFocused:focused,inputHtml:inputRef.current?inputRef.current.innerHTML:''}),showDropdown&&/*#__PURE__*/_jsxs(\"div\",{className:\"chat-suggestions-dropdown\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Bases dispon\\xEDveis\"}),/*#__PURE__*/_jsx(\"ul\",{children:filteredBases.length===0?/*#__PURE__*/_jsx(\"li\",{className:\"no-suggestion\",children:\"Resultado n\\xE3o encontrado\"}):filteredBases.map((base,i)=>/*#__PURE__*/_jsx(\"li\",{ref:el=>itemRefs.current[i]=el,className:hoveredIdx===i||hoveredIdx===null&&selectedIdx===i?'selected':'',onMouseDown:e=>e.preventDefault(),onMouseEnter:()=>setHoveredIdx(i),onMouseLeave:()=>setHoveredIdx(null),onClick:e=>{e.preventDefault();handleSelectBase(base);},children:base},base))})]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","IconAt","IconPlayerStop","IconX","ArrowUpOutlined","AnimatedPlaceholder","jsx","_jsx","jsxs","_jsxs","BASE_SUGGESTIONS","ChatPromptInput","_ref","value","onChange","onSend","onInsertBase","aiTyping","onCancelAi","inputRef","showDropdown","setShowDropdown","filteredBases","setFilteredBases","selectedIdx","setSelectedIdx","lastCaret","setLastCaret","hoveredIdx","setHoveredIdx","focused","setFocused","hasText","setHasText","tooltip","setTooltip","tooltipTimeoutRef","selectedTag","setSelectedTag","itemRefs","getPlainText","trim","_inputRef$current","current","innerText","insertHtmlAtCaret","html","sel","range","window","getSelection","getRangeAt","rangeCount","deleteContents","el","document","createElement","innerHTML","frag","createDocumentFragment","node","lastNode","firstChild","appendChild","insertNode","cloneRange","setStartAfter","collapse","removeAllRanges","addRange","hasTag","isReferencingSelectedTag","text","match","toLowerCase","handleInput","e","textUntilCursor","startsWith","length","clearTimeout","setTimeout","isAtAttempt","inputType","data","endsWith","preRange","selectNodeContents","setEnd","endContainer","endOffset","toString","filterBases","query","q","filtered","filter","b","includes","handleKeyDown","key","preventDefault","idx","handleSelectBase","shiftKey","getTextToSend","base","cameFromDropdown","startContainer","textContent","slice","startOffset","start","setStart","className","contentEditable","concat","space","createTextNode","after","focus","handleInsertBase","handleInsertContext","handleBeforeInput","handleClick","target","classList","contains","remove","handleRemoveTag","_inputRef$current2","tagElement","querySelector","plainText","scrollIntoView","block","style","position","children","display","alignItems","width","ref","spellCheck","onInput","onKeyDown","onBeforeInput","onClick","onFocus","onBlur","minHeight","outline","whiteSpace","flex","type","disabled","size","messages","inputFocused","inputHtml","map","i","onMouseDown","onMouseEnter","onMouseLeave"],"sources":["/Users/daniel/Desktop/chat-response/src/components/ChatPromptInput/ChatPromptInput.js"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport './ChatPromptInput.scss';\nimport { IconAt, IconPlayerStop, IconX } from '@tabler/icons-react';\nimport { ArrowUpOutlined } from '@ant-design/icons';\nimport AnimatedPlaceholder from '../AnimatedPlaceholder';\n\nconst BASE_SUGGESTIONS = [\n  'areas_quentes',\n  'base_1',\n  'base_2',\n  'lojas jun-2025',\n  'lojas mai-2025',\n  'lojas abr-2025'\n];\n\nexport default function ChatPromptInput({ value, onChange, onSend, onInsertBase, aiTyping, onCancelAi }) {\n  const inputRef = useRef();\n  const [showDropdown, setShowDropdown] = useState(false);\n  const [filteredBases, setFilteredBases] = useState(BASE_SUGGESTIONS);\n  const [selectedIdx, setSelectedIdx] = useState(0);\n  const [lastCaret, setLastCaret] = useState(null);\n  const [hoveredIdx, setHoveredIdx] = useState(null);\n  const [focused, setFocused] = useState(false);\n  const [hasText, setHasText] = useState(false);\n  const [tooltip, setTooltip] = useState(false);\n  const tooltipTimeoutRef = useRef();\n  const [selectedTag, setSelectedTag] = useState(null);\n  const itemRefs = useRef([]);\n\n  // Atualiza value externo e estado de texto\n  useEffect(() => {\n    if (onChange) onChange(getPlainText());\n    setHasText(!!getPlainText().trim() || selectedTag !== null);\n    // eslint-disable-next-line\n  }, []);\n\n  // Helper para pegar texto puro\n  function getPlainText() {\n    return inputRef.current?.innerText || '';\n  }\n\n  // Helper para inserir HTML no cursor\n  function insertHtmlAtCaret(html) {\n    let sel, range;\n    if (window.getSelection) {\n      sel = window.getSelection();\n      if (sel.getRangeAt && sel.rangeCount) {\n        range = sel.getRangeAt(0);\n        range.deleteContents();\n        const el = document.createElement('div');\n        el.innerHTML = html;\n        const frag = document.createDocumentFragment();\n        let node, lastNode;\n        while ((node = el.firstChild)) {\n          lastNode = frag.appendChild(node);\n        }\n        range.insertNode(frag);\n        // Move caret após a tag\n        if (lastNode) {\n          range = range.cloneRange();\n          range.setStartAfter(lastNode);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    }\n  }\n\n  // Helper para contar tags\n  function hasTag() {\n    return selectedTag !== null;\n  }\n\n  // Verifica se o texto digitado é uma referência à tag já selecionada\n  function isReferencingSelectedTag(text) {\n    if (!selectedTag) return false;\n    const match = text.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n    if (!match) return false;\n    return match[1].toLowerCase() === selectedTag.toLowerCase();\n  }\n\n  // Detecta @ e abre dropdown (apenas se não houver tag)\n  function handleInput(e) {\n    if (hasTag()) {\n      const textUntilCursor = inputRef.current.innerText;\n      const match = textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n      if (match && selectedTag) {\n        if (selectedTag.toLowerCase().startsWith(match[1].toLowerCase())) {\n          setShowDropdown(true);\n          setFilteredBases([selectedTag]);\n          setSelectedIdx(0);\n          if (onChange) onChange(inputRef.current.innerText);\n          setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n          return;\n        } else if (match[1].length > 0) {\n          // Se digitou algo diferente, mostra tooltip\n          setShowDropdown(false);\n          setFilteredBases(BASE_SUGGESTIONS);\n          setSelectedIdx(0);\n          if (onChange) onChange(inputRef.current.innerText);\n          setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n          setTooltip(true);\n          clearTimeout(tooltipTimeoutRef.current);\n          tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n          return;\n        }\n      }\n      setShowDropdown(false);\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n      if (onChange) onChange(inputRef.current.innerText);\n      setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n      // Mostra tooltip apenas se tentar digitar exatamente o caractere @\n      const isAtAttempt = (e.inputType === 'insertText' && e.data === '@') ||\n        (!e.inputType && inputRef.current.innerText.endsWith('@'));\n      if (isAtAttempt) {\n        setTooltip(true);\n        clearTimeout(tooltipTimeoutRef.current);\n        tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n      }\n      return;\n    }\n    const sel = window.getSelection();\n    setLastCaret(sel && sel.getRangeAt && sel.rangeCount ? sel.getRangeAt(0) : null);\n    let textUntilCursor = '';\n    if (sel && sel.rangeCount) {\n      const range = sel.getRangeAt(0);\n      const preRange = range.cloneRange();\n      preRange.selectNodeContents(inputRef.current);\n      preRange.setEnd(range.endContainer, range.endOffset);\n      textUntilCursor = preRange.toString();\n    } else {\n      textUntilCursor = inputRef.current.innerText;\n    }\n    const match = textUntilCursor.match(/@([\\w\\u00C0-\\u017F-]*)$/);\n    if (match) {\n      setShowDropdown(true);\n      filterBases(match[1]);\n    } else {\n      setShowDropdown(false);\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n    }\n    if (onChange) onChange(inputRef.current.innerText);\n    setHasText(!!inputRef.current.innerText.trim() || selectedTag !== null);\n  }\n\n  function filterBases(query) {\n    if (!query) {\n      setFilteredBases(BASE_SUGGESTIONS);\n      setSelectedIdx(0);\n      return;\n    }\n    const q = query.toLowerCase();\n    const filtered = BASE_SUGGESTIONS.filter(b => b.toLowerCase().includes(q));\n    setFilteredBases(filtered);\n    setSelectedIdx(0);\n  }\n\n  // Navegação teclado\n  function handleKeyDown(e) {\n    if (showDropdown) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedIdx(idx => (idx + 1) % filteredBases.length);\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedIdx(idx => (idx - 1 + filteredBases.length) % filteredBases.length);\n      } else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (filteredBases.length > 0) {\n          handleSelectBase(filteredBases[selectedIdx]);\n        }\n      } else if (e.key === 'Escape') {\n        setShowDropdown(false);\n      }\n    } else if (e.key === 'Enter' && !e.shiftKey) {\n      if (aiTyping) {\n        e.preventDefault(); // Não envia nada enquanto loading\n        return;\n      }\n      e.preventDefault();\n      if (onSend) onSend(getTextToSend());\n      inputRef.current.innerHTML = '';\n      if (onChange) onChange('');\n      setHasText(false);\n      setSelectedTag(null);\n    }\n  }\n\n  // Seleciona base\n  function handleSelectBase(base) {\n    const cameFromDropdown = showDropdown;\n    // Se já existe contexto e tentar selecionar outra base, mostra tooltip\n    if (selectedTag && base.toLowerCase() !== selectedTag.toLowerCase()) {\n      setTooltip(true);\n      clearTimeout(tooltipTimeoutRef.current);\n      tooltipTimeoutRef.current = setTimeout(() => setTooltip(false), 2000);\n      setShowDropdown(false);\n      return;\n    }\n    setShowDropdown(false);\n    setSelectedTag(base);\n    setHasText(!!getPlainText().trim() || base !== null);\n    if (cameFromDropdown) {\n      const sel = window.getSelection();\n      if (sel && sel.rangeCount) {\n        const range = sel.getRangeAt(0);\n        // Move o range para cobrir o @palavra antes do cursor\n        const node = range.startContainer;\n        let text = node.textContent;\n        const match = text.slice(0, range.startOffset).match(/@([\\w\\u00C0-\\u017F-]*)$/);\n        if (match) {\n          const start = range.startOffset - match[0].length;\n          range.setStart(node, start);\n          // Remove o @palavra\n          range.deleteContents();\n          // Insere a tag\n          const el = document.createElement('span');\n          el.className = 'chat-tag';\n          el.contentEditable = 'false';\n          el.textContent = `@${base}`;\n          range.insertNode(el);\n          // Espaço após a tag\n          const space = document.createTextNode(' ');\n          el.after(space);\n          // Move o cursor após o espaço\n          range.setStartAfter(space);\n          range.collapse(true);\n          sel.removeAllRanges();\n          sel.addRange(range);\n        }\n      }\n    }\n    if (onChange) onChange(getPlainText());\n    setTimeout(() => inputRef.current.focus(), 0);\n  }\n\n  // Botão inserir base (só se não houver tag)\n  function handleInsertBase() {\n    if (hasTag()) return;\n    inputRef.current.focus();\n    insertHtmlAtCaret('@');\n    const sel = window.getSelection();\n    if (sel && sel.rangeCount) {\n      const range = sel.getRangeAt(0);\n      range.setStart(range.endContainer, range.endOffset);\n      range.collapse(true);\n      sel.removeAllRanges();\n      sel.addRange(range);\n    }\n    setShowDropdown(true);\n    setFilteredBases(BASE_SUGGESTIONS);\n    setSelectedIdx(0);\n  }\n\n  // Inserir contexto via botão (sem modificar texto)\n  function handleInsertContext() {\n    if (hasTag()) return;\n    // Abre dropdown para seleção\n    setShowDropdown(true);\n    setFilteredBases(BASE_SUGGESTIONS);\n    setSelectedIdx(0);\n    inputRef.current.focus();\n  }\n\n  // Permite apagar tags normalmente\n  function handleBeforeInput(e) {\n    // Permite edição normal\n  }\n\n  // Clique na tag para remover\n  function handleClick(e) {\n    if (e.target.classList.contains('chat-tag')) {\n      e.preventDefault();\n      e.target.remove();\n      setSelectedTag(null);\n      if (onChange) onChange(getPlainText());\n    }\n  }\n\n  // Remove tag do botão\n  function handleRemoveTag() {\n    setSelectedTag(null);\n    setHasText(!!getPlainText().trim());\n    // Remove a tag do input também\n    const tagElement = inputRef.current?.querySelector('.chat-tag');\n    if (tagElement) {\n      tagElement.remove();\n      if (onChange) onChange(getPlainText());\n    }\n  }\n\n  // Limpa timeout do tooltip ao desmontar\n  useEffect(() => {\n    return () => clearTimeout(tooltipTimeoutRef.current);\n  }, []);\n\n  // Helper para pegar texto a ser enviado\n  function getTextToSend() {\n    const plainText = getPlainText().trim();\n    if (plainText) {\n      return plainText;\n    }\n    // Se não há texto mas há contexto selecionado, envia o nome da tag com @\n    if (selectedTag) {\n      return `@${selectedTag}`;\n    }\n    return '';\n  }\n\n  useEffect(() => {\n    if (showDropdown && itemRefs.current[selectedIdx]) {\n      itemRefs.current[selectedIdx].scrollIntoView({ block: 'nearest' });\n    }\n  }, [selectedIdx, showDropdown]);\n\n  return (\n    <div className=\"chat-prompt-input-wrapper\" style={{ position: 'relative' }}>\n      {tooltip && (\n        <span className=\"chat-tooltip\">Só é possível inserir uma base por mensagem.</span>\n      )}\n      <div style={{ display: 'flex', alignItems: 'flex-end', width: '100%' }}>\n        <div\n          className=\"chat-prompt-input\"\n          contentEditable\n          ref={inputRef}\n          spellCheck={true}\n          onInput={handleInput}\n          onKeyDown={handleKeyDown}\n          onBeforeInput={handleBeforeInput}\n          onClick={handleClick}\n          onFocus={() => setFocused(true)}\n          onBlur={() => setFocused(false)}\n          data-placeholder=\"Digite sua mensagem. Use @ para inserir uma base.\"\n          style={{ minHeight: 60, outline: 'none', whiteSpace: 'pre-wrap', flex: 1, position: 'relative' }}\n        />\n        <div className='input-actions'>\n          <button\n            type=\"button\"\n            className=\"chat-add-context\"\n            onClick={handleInsertContext}\n            disabled={hasTag()}\n          >\n            <IconAt size={12} />\n            Inserir contexto\n          </button>\n          {selectedTag && (\n            <button\n              type=\"button\"\n              className=\"chat-context\"\n              \n            >\n              <IconAt  />\n              {selectedTag}\n              <IconX className='close-ic' onClick={handleRemoveTag}/>\n            </button>\n          )}\n          <button\n            className={`chat-send-btn${hasText && !aiTyping ? ' active' : ''}${aiTyping ? ' loading' : ''}`}\n            type=\"button\"\n            onClick={() => {\n              if (aiTyping) {\n                if (onCancelAi) onCancelAi();\n              } else {\n                if (!showDropdown && onSend && hasText) {\n                  onSend(getTextToSend());\n                  inputRef.current.innerHTML = '';\n                  if (onChange) onChange('');\n                  setHasText(false);\n                  setSelectedTag(null);\n                }\n              }\n            }}\n            disabled={aiTyping && !onCancelAi || !hasText && !aiTyping}\n          >\n            {aiTyping ? <IconPlayerStop /> : <ArrowUpOutlined />}\n          </button>\n        </div>\n      </div>\n      {/* Placeholder animado sobre o input */}\n      {(!inputRef.current || !inputRef.current.innerText.trim()) && !focused && (\n        <AnimatedPlaceholder\n          messages={[\n            'Digite aqui para adicionar uma nova camada ao mapa',\n            'Tem alguma dúvida? Escreva aqui',\n            'Digite aqui para criar uma camada ou para tirar uma dúvida',\n            'Descreva a camada a ser criada ou pergunte algo',\n            'Digite @ para inserir um contexto de uma base de dados',\n            'Precisa de ajuda com o mapa? Fale aqui',\n            'Vamos explorar o mapa juntos? Escreva aqui a sua ideia',\n          ]}\n          inputFocused={focused}\n          inputHtml={inputRef.current ? inputRef.current.innerHTML : ''}\n        />\n      )}\n      {showDropdown && (\n        <div className=\"chat-suggestions-dropdown\">\n          <h3>Bases disponíveis</h3>\n          <ul>\n            {filteredBases.length === 0 ? (\n              <li className=\"no-suggestion\">Resultado não encontrado</li>\n            ) : (\n              filteredBases.map((base, i) => (\n                <li\n                  ref={el => itemRefs.current[i] = el}\n                  key={base}\n                  className={(hoveredIdx === i || (hoveredIdx === null && selectedIdx === i)) ? 'selected' : ''}\n                  onMouseDown={e => e.preventDefault()}\n                  onMouseEnter={() => setHoveredIdx(i)}\n                  onMouseLeave={() => setHoveredIdx(null)}\n                  onClick={e => {\n                    e.preventDefault();\n                    handleSelectBase(base);\n                  }}\n                >\n                  {base}\n                </li>\n              ))\n            )}\n          </ul>\n        </div>\n      )}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}